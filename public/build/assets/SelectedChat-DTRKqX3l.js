import{a3 as Se,a4 as _e,a5 as Pe,r as m,a6 as Ie,j as a,k as Me,a7 as Ee,a8 as Te,l as Oe,d as Ae,f as Ne,i as Re,F as ee,x as B,a9 as ne,I as te,J as $e,K as M,aa as Ge,ab as Fe,E as C,M as H,S as Le,T as L,O as q,ac as ze,ad as Y,ae as Be,af as se,$ as P,Q as qe,a1 as ie,ag as We,ah as De,ai as Xe,aj as Qe,ak as Ve,al as Ke,am as He,an as Ye,ao as Je,ap as Ue,a0 as Ze}from"./index-DwUKqWVr.js";import{g as en,u as nn}from"./functions-Ds7nz9hD.js";const tn=(s,i)=>s.filter(n=>i.includes(n)),_=(s,i,n)=>{const t=s.keys[0];Array.isArray(i)?i.forEach((e,r)=>{n((o,c)=>{r<=s.keys.length-1&&(r===0?Object.assign(o,c):o[s.up(s.keys[r])]=c)},e)}):i&&typeof i=="object"?(Object.keys(i).length>s.keys.length?s.keys:tn(s.keys,Object.keys(i))).forEach(r=>{if(s.keys.includes(r)){const o=i[r];o!==void 0&&n((c,u)=>{t===r?Object.assign(c,u):c[s.up(r)]=u},o)}}):(typeof i=="number"||typeof i=="string")&&n((e,r)=>{Object.assign(e,r)},i)};function T(s){return`--Grid-${s}Spacing`}function N(s){return`--Grid-parent-${s}Spacing`}const J="--Grid-columns",S="--Grid-parent-columns",sn=({theme:s,ownerState:i})=>{const n={};return _(s.breakpoints,i.size,(t,e)=>{let r={};e==="grow"&&(r={flexBasis:0,flexGrow:1,maxWidth:"100%"}),e==="auto"&&(r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof e=="number"&&(r={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${e} / var(${S}) - (var(${S}) - ${e}) * (var(${N("column")}) / var(${S})))`}),t(n,r)}),n},rn=({theme:s,ownerState:i})=>{const n={};return _(s.breakpoints,i.offset,(t,e)=>{let r={};e==="auto"&&(r={marginLeft:"auto"}),typeof e=="number"&&(r={marginLeft:e===0?"0px":`calc(100% * ${e} / var(${S}) + var(${N("column")}) * ${e} / var(${S}))`}),t(n,r)}),n},on=({theme:s,ownerState:i})=>{if(!i.container)return{};const n={[J]:12};return _(s.breakpoints,i.columns,(t,e)=>{const r=e??12;t(n,{[J]:r,"> *":{[S]:r}})}),n},an=({theme:s,ownerState:i})=>{if(!i.container)return{};const n={};return _(s.breakpoints,i.rowSpacing,(t,e)=>{var o;const r=typeof e=="string"?e:(o=s.spacing)==null?void 0:o.call(s,e);t(n,{[T("row")]:r,"> *":{[N("row")]:r}})}),n},cn=({theme:s,ownerState:i})=>{if(!i.container)return{};const n={};return _(s.breakpoints,i.columnSpacing,(t,e)=>{var o;const r=typeof e=="string"?e:(o=s.spacing)==null?void 0:o.call(s,e);t(n,{[T("column")]:r,"> *":{[N("column")]:r}})}),n},un=({theme:s,ownerState:i})=>{if(!i.container)return{};const n={};return _(s.breakpoints,i.direction,(t,e)=>{t(n,{flexDirection:e})}),n},ln=({ownerState:s})=>({minWidth:0,boxSizing:"border-box",...s.container&&{display:"flex",flexWrap:"wrap",...s.wrap&&s.wrap!=="wrap"&&{flexWrap:s.wrap},gap:`var(${T("row")}) var(${T("column")})`}}),hn=s=>{const i=[];return Object.entries(s).forEach(([n,t])=>{t!==!1&&t!==void 0&&i.push(`grid-${n}-${String(t)}`)}),i},fn=(s,i="xs")=>{function n(t){return t===void 0?!1:typeof t=="string"&&!Number.isNaN(Number(t))||typeof t=="number"&&t>0}if(n(s))return[`spacing-${i}-${String(s)}`];if(typeof s=="object"&&!Array.isArray(s)){const t=[];return Object.entries(s).forEach(([e,r])=>{n(r)&&t.push(`spacing-${e}-${String(r)}`)}),t}return[]},pn=s=>s===void 0?[]:typeof s=="object"?Object.entries(s).map(([i,n])=>`direction-${i}-${n}`):[`direction-xs-${String(s)}`],dn=Se(),vn=_e("div",{name:"MuiGrid",slot:"Root",overridesResolver:(s,i)=>i.root});function yn(s){return Te({props:s,name:"MuiGrid",defaultTheme:dn})}function gn(s={}){const{createStyledComponent:i=vn,useThemeProps:n=yn,useTheme:t=Pe,componentName:e="MuiGrid"}=s,r=(l,v)=>{const{container:w,direction:g,spacing:k,wrap:y,size:R}=l,$={root:["root",w&&"container",y!=="wrap"&&`wrap-xs-${String(y)}`,...pn(g),...hn(R),...w?fn(k,v.breakpoints.keys[0]):[]]};return Oe($,G=>Ae(e,G),{})};function o(l,v,w=()=>!0){const g={};return l===null||(Array.isArray(l)?l.forEach((k,y)=>{k!==null&&w(k)&&v.keys[y]&&(g[v.keys[y]]=k)}):typeof l=="object"?Object.keys(l).forEach(k=>{const y=l[k];y!=null&&w(y)&&(g[k]=y)}):g[v.keys[0]]=l),g}const c=i(on,cn,an,sn,un,ln,rn),u=m.forwardRef(function(v,w){const g=t(),k=n(v),y=Ie(k),{className:R,children:$,columns:G=12,container:Q=!1,component:le="div",direction:he="row",wrap:fe="wrap",size:pe={},offset:de={},spacing:F=0,rowSpacing:ve=F,columnSpacing:ye=F,unstable_level:j=0,...ge}=y,ke=o(pe,g.breakpoints,b=>b!==!1),me=o(de,g.breakpoints),be=v.columns??(j?void 0:G),xe=v.spacing??(j?void 0:F),Ce=v.rowSpacing??v.spacing??(j?void 0:ve),we=v.columnSpacing??v.spacing??(j?void 0:ye),V={...y,level:j,columns:be,container:Q,direction:he,wrap:fe,spacing:xe,rowSpacing:Ce,columnSpacing:we,size:ke,offset:me},je=r(V,g);return a.jsx(c,{ref:w,as:le,ownerState:V,className:Me(je.root,R),...ge,children:m.Children.map($,b=>{var K;return m.isValidElement(b)&&Ee(b,["Grid"])&&Q&&b.props.container?m.cloneElement(b,{unstable_level:((K=b.props)==null?void 0:K.unstable_level)??j+1}):b})})});return u.muiName="Grid",u}const x=gn({createStyledComponent:Ne("div",{name:"MuiGrid2",slot:"Root",overridesResolver:(s,i)=>{const{ownerState:n}=s;return[i.root,n.container&&i.container]}}),componentName:"MuiGrid2",useThemeProps:s=>Re({props:s,name:"MuiGrid2"}),useTheme:ee});function kn(s){return a.jsx(B,{sx:{position:"fixed",left:0,height:"55px",width:"100%",padding:1},children:a.jsx(ne,{children:a.jsxs(x,{container:!0,spacing:2,sx:{height:"100%",alignItems:"center"},children:[a.jsx(x,{sx:{cursor:"pointer"},children:a.jsx(te,{component:$e,to:"/chat/all",children:a.jsx(M,{icon:Ge})})}),a.jsx(x,{children:s.nameChat})]})})})}const mn=Fe.getSelectors(s=>s.messages.messages);function bn(s){const i=C(r=>r.user.id),n=ee(),t=s.itemMessage.user_id==i,e=s.itemMessage.viewed_at===null;return a.jsxs(x,{container:!0,sx:{justifyContent:t?"end":"",alignItems:"flex-end",my:2},children:[e&&t&&a.jsx(M,{icon:H,color:n.palette.chat.pointNotRead,size:"xs"}),a.jsxs(B,{onContextMenu:s.onContextMenu,sx:{backgroundColor:t?"chat.selfMessageBackground":"chat.someoneMessageBackground",padding:1,mx:1,maxWidth:"50%",color:t?"chat.selfMessageTextColor":"chat.someoneMessageTextColor"},children:[a.jsx(Le,{direction:"row",children:a.jsx(L,{children:s.itemMessage.message})}),a.jsx(L,{sx:{textAlign:"right",display:"block"},variant:"caption",children:en(s.itemMessage.created_at)})]}),e&&!t&&a.jsx(M,{icon:H,color:n.palette.chat.pointNotRead,size:"xs"})]})}function xn(s){const i=q(),n=()=>{s.targetMessage&&i(Be(s.targetMessage.id)),s.handleClose()},t=()=>{s.targetMessage&&i(se({id:s.targetMessage.id,message:s.targetMessage.message})),s.handleClose()};return a.jsxs(ze,{open:s.contextMenu!==null,onClose:s.handleClose,anchorReference:"anchorPosition",anchorPosition:s.contextMenu!==null?{top:s.contextMenu.mouseY,left:s.contextMenu.mouseX}:void 0,children:[a.jsx(Y,{onClick:t,children:"Редактировать"}),a.jsx(Y,{onClick:n,children:"Удалить"})]})}function Cn(){const s=m.useRef(null),[i,n]=m.useState(null),[t,e]=m.useState(null),r=C(mn.selectAll);m.useEffect(()=>{var u;(u=s.current)==null||u.scrollIntoView({behavior:"auto"})},[]);const o=(u,l)=>{u.preventDefault(),n(i===null?{mouseX:u.clientX+2,mouseY:u.clientY-6}:null),e(l)},c=()=>{n(null)};return a.jsxs(P,{children:[r.map(u=>a.jsx(bn,{itemMessage:u,onContextMenu:l=>o(l,u)},u.id)),a.jsx(xn,{handleClose:c,contextMenu:i,targetMessage:t}),a.jsx("div",{ref:s})]})}function wn(s){const i=q(),n=C(c=>c.messages.editingMessage),t=C(c=>c.messages.loadingStatusEditing)==="loading",e=C(c=>c.messages.loadingStatusEditing)==="failed",r=()=>{i(Qe({chat_id:s.chatId,...n}))},o=c=>{c.key==="Enter"&&r()};return a.jsx(B,{sx:{position:"fixed",bottom:0,left:0,height:"80px",width:"100%"},children:a.jsxs(ne,{children:[n.id&&a.jsx(L,{variant:"subtitle2",children:"Редактирование сообщения"}),a.jsxs(x,{container:!0,spacing:2,sx:{height:"100%",alignItems:"center"},children:[a.jsx(x,{size:10,children:a.jsx(qe,{onKeyDown:o,fullWidth:!0,value:n.message,onChange:c=>i(se({...n,message:c.target.value}))})}),a.jsxs(x,{size:1,children:[t&&a.jsx(ie,{}),!t&&a.jsx(te,{onClick:r,children:a.jsx(M,{icon:We})})]}),a.jsx(x,{size:1,children:e&&a.jsx(De,{title:"Произошла ошибка во время отправки",children:a.jsx(M,{icon:Xe,color:"red",size:"2x"})})})]})]})})}function I(s){"@babel/helpers - typeof";return I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},I(s)}function h(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")}function jn(s,i){for(var n=0;n<i.length;n++){var t=i[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,t.key,t)}}function f(s,i,n){return i&&jn(s.prototype,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function E(){return E=Object.assign||function(s){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},E.apply(this,arguments)}function p(s,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(i&&i.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),i&&z(s,i)}function O(s){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},O(s)}function z(s,i){return z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},z(s,i)}function Sn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _n(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Pn(s,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _n(s)}function d(s){var i=Sn();return function(){var t=O(s),e;if(i){var r=O(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Pn(this,e)}}var W=function(){function s(){h(this,s)}return f(s,[{key:"listenForWhisper",value:function(n,t){return this.listen(".client-"+n,t)}},{key:"notification",value:function(n){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",n)}},{key:"stopListeningForWhisper",value:function(n,t){return this.stopListening(".client-"+n,t)}}]),s}(),re=function(){function s(i){h(this,s),this.namespace=i}return f(s,[{key:"format",value:function(n){return[".","\\"].includes(n.charAt(0))?n.substring(1):(this.namespace&&(n=this.namespace+"."+n),n.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(n){this.namespace=n}}]),s}();function In(s){try{new s}catch(i){if(i.message.includes("is not a constructor"))return!1}return!0}var D=function(s){p(n,s);var i=d(n);function n(t,e,r){var o;return h(this,n),o=i.call(this),o.name=e,o.pusher=t,o.options=r,o.eventFormatter=new re(o.options.namespace),o.subscribe(),o}return f(n,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(e,r){return this.on(this.eventFormatter.format(e),r),this}},{key:"listenToAll",value:function(e){var r=this;return this.subscription.bind_global(function(o,c){if(!o.startsWith("pusher:")){var u=r.options.namespace.replace(/\./g,"\\"),l=o.startsWith(u)?o.substring(u.length+1):"."+o;e(l,c)}}),this}},{key:"stopListening",value:function(e,r){return r?this.subscription.unbind(this.eventFormatter.format(e),r):this.subscription.unbind(this.eventFormatter.format(e)),this}},{key:"stopListeningToAll",value:function(e){return e?this.subscription.unbind_global(e):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(e){return this.on("pusher:subscription_succeeded",function(){e()}),this}},{key:"error",value:function(e){return this.on("pusher:subscription_error",function(r){e(r)}),this}},{key:"on",value:function(e,r){return this.subscription.bind(e,r),this}}]),n}(W),oe=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"whisper",value:function(e,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),r),this}}]),n}(D),Mn=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"whisper",value:function(e,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),r),this}}]),n}(D),En=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"here",value:function(e){return this.on("pusher:subscription_succeeded",function(r){e(Object.keys(r.members).map(function(o){return r.members[o]}))}),this}},{key:"joining",value:function(e){return this.on("pusher:member_added",function(r){e(r.info)}),this}},{key:"whisper",value:function(e,r){return this.pusher.channels.channels[this.name].trigger("client-".concat(e),r),this}},{key:"leaving",value:function(e){return this.on("pusher:member_removed",function(r){e(r.info)}),this}}]),n}(oe),ae=function(s){p(n,s);var i=d(n);function n(t,e,r){var o;return h(this,n),o=i.call(this),o.events={},o.listeners={},o.name=e,o.socket=t,o.options=r,o.eventFormatter=new re(o.options.namespace),o.subscribe(),o}return f(n,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(e,r){return this.on(this.eventFormatter.format(e),r),this}},{key:"stopListening",value:function(e,r){return this.unbindEvent(this.eventFormatter.format(e),r),this}},{key:"subscribed",value:function(e){return this.on("connect",function(r){e(r)}),this}},{key:"error",value:function(e){return this}},{key:"on",value:function(e,r){var o=this;return this.listeners[e]=this.listeners[e]||[],this.events[e]||(this.events[e]=function(c,u){o.name===c&&o.listeners[e]&&o.listeners[e].forEach(function(l){return l(u)})},this.socket.on(e,this.events[e])),this.listeners[e].push(r),this}},{key:"unbind",value:function(){var e=this;Object.keys(this.events).forEach(function(r){e.unbindEvent(r)})}},{key:"unbindEvent",value:function(e,r){this.listeners[e]=this.listeners[e]||[],r&&(this.listeners[e]=this.listeners[e].filter(function(o){return o!==r})),(!r||this.listeners[e].length===0)&&(this.events[e]&&(this.socket.removeListener(e,this.events[e]),delete this.events[e]),delete this.listeners[e])}}]),n}(W),ce=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"whisper",value:function(e,r){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:r}),this}}]),n}(ae),Tn=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"here",value:function(e){return this.on("presence:subscribed",function(r){e(r.map(function(o){return o.user_info}))}),this}},{key:"joining",value:function(e){return this.on("presence:joining",function(r){return e(r.user_info)}),this}},{key:"whisper",value:function(e,r){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:r}),this}},{key:"leaving",value:function(e){return this.on("presence:leaving",function(r){return e(r.user_info)}),this}}]),n}(ce),A=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(e,r){return this}},{key:"listenToAll",value:function(e){return this}},{key:"stopListening",value:function(e,r){return this}},{key:"subscribed",value:function(e){return this}},{key:"error",value:function(e){return this}},{key:"on",value:function(e,r){return this}}]),n}(W),ue=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"whisper",value:function(e,r){return this}}]),n}(A),On=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"whisper",value:function(e,r){return this}}]),n}(A),An=function(s){p(n,s);var i=d(n);function n(){return h(this,n),i.apply(this,arguments)}return f(n,[{key:"here",value:function(e){return this}},{key:"joining",value:function(e){return this}},{key:"whisper",value:function(e,r){return this}},{key:"leaving",value:function(e){return this}}]),n}(ue),X=function(){function s(i){h(this,s),this._defaultOptions={channelAuthorization:{endpoint:"/broadcasting/auth",headers:{}},userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(i),this.connect()}return f(s,[{key:"setOptions",value:function(n){this.options=E(this._defaultOptions,n);var t=this.csrfToken();return t&&(this.options.channelAuthorization.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),t=this.options.bearerToken,t&&(this.options.channelAuthorization.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t),n}},{key:"csrfToken",value:function(){var n;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(n=document.querySelector('meta[name="csrf-token"]'))?n.getAttribute("content"):null}}]),s}(),U=function(s){p(n,s);var i=d(n);function n(){var t;return h(this,n),t=i.apply(this,arguments),t.channels={},t}return f(n,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(e,r,o){return this.channel(e).listen(r,o)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new D(this.pusher,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new oe(this.pusher,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"encryptedPrivateChannel",value:function(e){return this.channels["private-encrypted-"+e]||(this.channels["private-encrypted-"+e]=new Mn(this.pusher,"private-encrypted-"+e,this.options)),this.channels["private-encrypted-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new En(this.pusher,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var r=this,o=[e,"private-"+e,"private-encrypted-"+e,"presence-"+e];o.forEach(function(c,u){r.leaveChannel(c)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),n}(X),Z=function(s){p(n,s);var i=d(n);function n(){var t;return h(this,n),t=i.apply(this,arguments),t.channels={},t}return f(n,[{key:"connect",value:function(){var e=this,r=this.getSocketIO();return this.socket=r(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(e.channels).forEach(function(o){o.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(e,r,o){return this.channel(e).listen(r,o)}},{key:"channel",value:function(e){return this.channels[e]||(this.channels[e]=new ae(this.socket,e,this.options)),this.channels[e]}},{key:"privateChannel",value:function(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new ce(this.socket,"private-"+e,this.options)),this.channels["private-"+e]}},{key:"presenceChannel",value:function(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new Tn(this.socket,"presence-"+e,this.options)),this.channels["presence-"+e]}},{key:"leave",value:function(e){var r=this,o=[e,"private-"+e,"presence-"+e];o.forEach(function(c){r.leaveChannel(c)})}},{key:"leaveChannel",value:function(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),n}(X),Nn=function(s){p(n,s);var i=d(n);function n(){var t;return h(this,n),t=i.apply(this,arguments),t.channels={},t}return f(n,[{key:"connect",value:function(){}},{key:"listen",value:function(e,r,o){return new A}},{key:"channel",value:function(e){return new A}},{key:"privateChannel",value:function(e){return new ue}},{key:"encryptedPrivateChannel",value:function(e){return new On}},{key:"presenceChannel",value:function(e){return new An}},{key:"leave",value:function(e){}},{key:"leaveChannel",value:function(e){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),n}(X),Rn=function(){function s(i){h(this,s),this.options=i,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return f(s,[{key:"channel",value:function(n){return this.connector.channel(n)}},{key:"connect",value:function(){if(this.options.broadcaster=="reverb")this.connector=new U(E(E({},this.options),{cluster:""}));else if(this.options.broadcaster=="pusher")this.connector=new U(this.options);else if(this.options.broadcaster=="socket.io")this.connector=new Z(this.options);else if(this.options.broadcaster=="null")this.connector=new Nn(this.options);else if(typeof this.options.broadcaster=="function"&&In(this.options.broadcaster))this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(I(this.options.broadcaster)," ").concat(this.options.broadcaster," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(n){return this.connector.presenceChannel(n)}},{key:"leave",value:function(n){this.connector.leave(n)}},{key:"leaveChannel",value:function(n){this.connector.leaveChannel(n)}},{key:"leaveAllChannels",value:function(){for(var n in this.connector.channels)this.leaveChannel(n)}},{key:"listen",value:function(n,t,e){return this.connector.listen(n,t,e)}},{key:"private",value:function(n){return this.connector.privateChannel(n)}},{key:"encryptedPrivate",value:function(n){if(this.connector instanceof Z)throw new Error("Broadcaster ".concat(I(this.options.broadcaster)," ").concat(this.options.broadcaster," does not support encrypted private channels."));return this.connector.encryptedPrivateChannel(n)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":I(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var n=this;Vue.http.interceptors.push(function(t,e){n.socketId()&&t.headers.set("X-Socket-ID",n.socketId()),e()})}},{key:"registerAxiosRequestInterceptor",value:function(){var n=this;axios.interceptors.request.use(function(t){return n.socketId()&&(t.headers["X-Socket-Id"]=n.socketId()),t})}},{key:"registerjQueryAjaxSetup",value:function(){var n=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(t,e,r){n.socketId()&&r.setRequestHeader("X-Socket-Id",n.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var n=this;document.addEventListener("turbo:before-fetch-request",function(t){t.detail.fetchOptions.headers["X-Socket-Id"]=n.socketId()})}}]),s}();function Fn(){const{chatId:s}=Ve(),i=q(),n=C(o=>o.user.id),t=C(o=>o.chats.selectedChat),e=C(o=>o.messages.loadingStatus)==="loading",r=m.useMemo(()=>n==(t==null?void 0:t.user1.id)?t==null?void 0:t.user2.name:t==null?void 0:t.user1.name,[n,t==null?void 0:t.user1.name,t==null?void 0:t.user2.name])||"";return nn(()=>{const o=new Rn({broadcaster:"reverb",key:"dc3kzqgkdtak2brpw91d",wsHost:"138.124.55.208",wsPort:9001,forceTLS:!1});return o.channel("chat-channel").listen(".message-sent",c=>{console.log("Received event:",c.channel)}),o.channel("chat-channel").listenToAll(c=>{console.log("Received event:",c.channel)}),s&&(i(Ke({chat_id:Number(s)})),i(He(Number(s)))),()=>{i(Ye([])),i(Je(null))}},[s]),Ue({label:r,depth:3}),a.jsxs(a.Fragment,{children:[e&&t===null&&a.jsx(Ze,{open:!0,children:a.jsx(ie,{})}),!!s&&t!==null&&a.jsxs(P,{children:[a.jsx(kn,{nameChat:r}),a.jsx(P,{sx:{height:"55px"}}),a.jsx(Cn,{}),a.jsx(P,{sx:{height:"80px"}}),a.jsx(wn,{chatId:Number(s)})]}),!s&&a.jsx(P,{children:"Такой чат отсутствует!"})]})}export{Fn as default};
